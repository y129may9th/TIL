## ロールバック
なんらかの事情で戻す（バージョンを下げる、適用したマイグレーションを取り消す）

- バージョンを上げる際のスキーマ変更  
- バージョンを下げる際のスキーマ変更  
`:from`  
`:to`  
どの値からどの値へ変更するか知らせる  
`$ be rails db:rollback`

## redo
ロールバックできないトラブルを防ぐ  
マイグレーションを書いたときに確実にロールバックが成功することを確認する  
1. `$ be rails db:migrate`で自分の書いたマイグレーションがバージョンを上げる際に期待通り動作するか
1. `$ be rails db:migrate:redo`　で自分の書いたマイグレーションがバージョンを下げる際にトラブルを起こさないことを確認する

## Squasher(gem)
複数のマイグレーションファイルを一つに集約する

## アプリケーションコードの参照はなるべく避ける
ActiveRecordをマイグレーションから安全に利用する
- アプリケーションコードを参照する代わりに、マイグレーションの中に閉じたモデルクラスを定義して利用する

## 一度にインスタンス化するレコード数に気をつける
- 一度に大量のメモリを確保しようとする
- サーバーが不安定になる
- `find_each`
レコードを1000件単位で分割して取得  
1001件目の取得時に、最初の1000件を格納したメモリを解放する


