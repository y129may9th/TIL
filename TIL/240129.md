# Github Actions

## ä½•

ãƒ†ã‚¹ãƒˆã‚„ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãªã©ã®å®Ÿè¡Œã‚’è‡ªå‹•åŒ–ã§ãã‚‹ãƒ„ãƒ¼ãƒ«
Github ã§ç™ºç”Ÿã™ã‚‹ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹

## Flutter ã§ä½¿ã†

### Check

- flutter_lints
  - Flutter ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ–°ã—ãä½œã‚‹ã¨ã€ã“ãƒ¼ãƒ•ã‚©ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚„å“è³ªã®ãŸã‚ã€ã“ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒä¸€ç·’ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹
  - `flutter analyze`ï¼ˆé™çš„è§£æï¼‰
  - `flutter format`

### Test

- UT/ Widget/Integration Test
- VRTï¼ˆVisual Regression Testï¼‰
- `flutter test`

### Build and Deploy

- Stg
- Prod

### Bump up

- ï¼ˆã¾ã ã‚ã‹ã£ã¦ãªã„ï¼‰

### Nightly build

- ï¼ˆã¾ã ã‚ã‹ã£ã¦ãªã„ï¼‰

### Github ãŒæä¾›ã—ã¦ã„ã‚‹ Runner ã«ã¯ flutter SDK ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„

- ãƒ†ã‚¹ãƒˆã‚„ãƒ“ãƒ«ãƒ‰ã‚’è¡Œã†ãŸã‚ã« SDK ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…è¦
  - third-party ã®Git ã‹ã‚‰ç›´æ¥ clone ã—ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ç›®çš„ã§ Runner ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
  - é™çš„è§£æã‚„ãƒ†ã‚¹ãƒˆ
    - Linux
  - ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
    - Android ã‚„ Web ã¯Linux
    - iOS ã¯ macOS

## ç‰¹å¾´

-  Github-hosted runner
- Github ãŒæ¨™æº–ã§æä¾›ã—ã¦ã„ã‚‹CI ã®å®Ÿè¡Œç’°å¢ƒ
  - Windows, Linux (ubuntu), macOS ã‹ã‚‰é¸æŠå¯èƒ½
- Github ãŒé‹ç”¨ç®¡ç†ã—ã¦ã„ã‚‹ãŸã‚ã€è‡ªåˆ†ã§ã®ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã¯ä¸è¦
- ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œå˜ä½ã§ã¾ã£ã•ã‚‰ãªã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã‚‹
- åˆ†å˜ä½ã§èª²é‡‘
  - macOS ã¯ Linux ï¼ˆä¸€ç•ªå®‰ã„ï¼‰ã®10å€ã®æ–™é‡‘
- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®å®šç¾©ã¯yaml ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ã€å†åˆ©ç”¨æ€§ãŒé«˜ã„

## è¨­å®š

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã«ã™ã‚‹ `on`

  cf. [ã‚®ãƒƒãƒˆãƒãƒ–ã€€ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã€€ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼æ§‹æ–‡ - GitHub Docs https://docs.github.com/ja/actions/using-workflows/workflow-syntax-for-github-actions]

```yml
 on: [push, fork]
```
```yml
## on.<event_name>.types
 on:
   pull_request:
     types: [ open, synchronize ]
 ## on.<pull_request|pull_request_target>.<branches|branches-ignore>
 ## ãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã™ã‚‹ pull_request ã«å¯¾ã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå‹•ã
 on:
   pull_request:
     branches:
       - main
       - 'mona/octocat'
       - 'releases/**'
```

### jobs

```yml
   ## jobs.<jobs_id>
   jobs:
     my_first_job:
      ## jobs.<jobs_id>.name ã¯ã€Github UI ã«è¡¨ç¤ºã•ã‚Œã‚‹
       name: My first job
     my_second_job:
       name: My second job
```

### steps

- job ã§å®Ÿè¡Œã•ã‚Œã‚‹å€‹ã€…ã®ã‚¿ã‚¹ã‚¯
- Stepã”ã¨ã«1ã¤ã®ã‚·ã‚§ãƒ«ãŒä¸ãˆã‚‰ã‚‹ã€‚

```yaml
   ## jobs.<job_id>.steps
   jobs:
     my-job:
       name: My Job
       runs-on: ubuntu-latest
       steps:
         - name: Print a greeting
         ## jobs.<job_id>.steps[*].uses ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä½¿ç”¨
         - uses: actions/checkout@v2
           ## with ã¯ input ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
           with:
             fetch-depth: 0
```

- fetch-depth: 0 ã®ä»•æ§˜ã«ã¤ã„ã¦
  - `actions/checkout@v2` ã«ãŠã„ã¦ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚ã®æ™‚é–“çŸ­ç¸®ã®ãŸã‚ã€æŒ‡å®šã•ã‚ŒãŸãƒ–ãƒ©ãƒ³ãƒã®å…ˆé ­ã‚³ãƒŸãƒƒãƒˆã—ã‹å–å¾— fetch ã—ãªã„
  - ãã®çŠ¶æ…‹ã§ git checkout ã—ã¦ã‚‚ `error: pathspec 'xxxxxxx' did not match any file(s) known to git` ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹
    `fetch-depth: 0` ã®æŒ‡å®šã«ã‚ˆã‚Šã€å…¨ã‚¿ã‚°ãƒ»å…¨ãƒ–ãƒ©ãƒ³ãƒãƒ»å…¨å±¥æ­´ã‚’å–å¾—ã™ã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã€æ¬¡ã®git checkoutãŒæ„å›³é€šã‚Šå‹•ã
  - https://github.com/actions/checkout/issues/265
  - [GitHub Actionsã§ç‰¹å®šã®ã‚³ãƒŸãƒƒãƒˆã‚’checkoutã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’å®Ÿè¡Œã™ã‚‹](https://zenn.dev/satococoa/articles/e026c0689e5678)

## workflow_dispatch

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒä¸Šã«ãªãã¦ã‚‚æ‰‹å‹•å®Ÿè¡Œã§ãã‚‹
- on-push ãªã©ã®è‡ªå‹•åŒ–ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã®ãƒˆãƒªã‚¬ãƒ¼ã‚‚æ‰‹å‹•ã§å®Ÿè¡Œã§ãã‚‹
  - <https://docs.github.com/en/actions/using-workflows/manually-running-a-workflow?tool=webui>
  - [GitHub workflow dispatchã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ–ãƒ©ãƒ³ãƒä»¥å¤–ã§å®Ÿè¡Œã™ã‚‹](https://zenn.dev/johnn26/articles/gha-workflow-dispatch)
- æ‰‹å…ƒã‹ã‚‰å®Ÿè¡Œ

  ```bash
   gh workflow run "<ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å>" --ref <ãƒ–ãƒ©ãƒ³ãƒå>
  ```

## Composite actions ã§å†åˆ©ç”¨æ€§ã‚’é«˜ã‚ã‚‹

 [ğŸ“„ Composite action] ã“ã£ã¡ã«ã¾ã¨ã‚ãŸ

### ã‚¨ãƒ©ãƒ¼ãƒ»ãƒˆãƒ©ãƒ–ãƒ«

#### `could not create workflow dispatch event: HTTP 403: Must have admin rights to Repository.` ã‚¨ãƒ©ãƒ¼ã§ workflow_dispatch ã‚’å®Ÿè¡Œã§ããªã„

- [GitHub Actionsã®permissionã‚’ç²›ã€…ã¨æ•´ç†ã—ãŸè©± - 10X Product Blog](https://product.10x.co.jp/entry/2023/10/18/170930)
- [github actionsã®ã€Œpermissionsã€ã¨ã¯ãªã«ã‹ï¼Ÿ](https://zenn.dev/not75743/scraps/926f2693809744)
- [Working with GitHub secrets without admin rights](https://devopsjournal.io/blog/2022/11/02/GitHub-secrets-without-admin-rights)
  - ã„ãšã‚Œã‚‚è§£æ±ºã§ããšã€
  - `gh auth status` ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ç¢ºèªã—ãŸã‚‰ã€ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãŒä¼šç¤¾ã®ã‚‚ã®ã«ãªã£ã¦ã„ãŸã®ã§ã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆå¢ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ç›´ã—ãŸ
    - `gh auth login` è§£æ±º
    - [ğŸ“„ GIthub CLI] ã«ã¤ã„ã¦

## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

 [ä¾å­˜é–¢ä¿‚ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®ã‚¹ãƒ”ãƒ¼ãƒ‰ã‚’ä¸Šã’ã‚‹ - GitHub Docs https://docs.github.com/ja/actions/using-workflows/caching-dependencies-to-speed-up-workflows]
 [GitHub Actions ã® Cache ç®¡ç†(2023 å¹´ 1 æœˆã®å ´åˆ) https://zenn.dev/hankei6km/articles/manage-cache-in-github-actions-2023-01]

## å‚è€ƒ

- [ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ãƒˆãƒªã‚¬ãƒ¼ã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆ - GitHub Docs](https://docs.github.com/ja/actions/using-workflows/events-that-trigger-workflows)
 [Flutter action Â· Actions Â· GitHub Marketplace Â· GitHub](https://github.com/marketplace/actions/flutter-action)
 [Flutteré–‹ç™ºã¨GitHub Actions | ãƒ‰ã‚¯ã‚»ãƒ«](https://www.docswell.com/s/yorifuji/KGXMNM-2023-10-26-011249)

### ã‚„ã‚ŠãŸã„ã“ã¨

[ğŸ“„ ãƒªãƒªãƒ¼ã‚¹è‡ªå‹•åŒ–]

- [GitHub Actionsã§Flutter Windowsã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹](https://zenn.dev/minma/articles/3c1d5dd6f34e43)
  [GitHub Actionsã§Releaseã‚’è‡ªå‹•åŒ–ã™ã‚‹æ–¹æ³•ã¨ã—ãŸã¨ãã«å¾—ãŸå­¦ã³ | sKawashima&#39;s blog](https://skawashima.com/blog/2019/12/github-actions-auto-release/)
çŸ¥ã£ã¦ãŠãã¨å½¹ã«ç«‹ã¡ãã†
 [ã€GitHub Actionsã€‘stepãƒ»jobã‚’ã¾ãŸããƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã¾ã¨ã‚ #GitHub - Qiita](https://qiita.com/kitta65/items/9c19b323e8c4e837827c)
